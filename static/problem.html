<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choose the Mission</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .back-btn {
      position: fixed;
      top: 32px;
      left: 32px;
      z-index: 10000;
      background: #181818;
      color: #fff;
      border: 2px solid #c10016;
      border-radius: 10px;
      font-size: 1.1rem;
      font-family: 'Roboto', Arial, sans-serif;
      font-weight: 700;
      padding: 10px 28px;
      cursor: pointer;
      box-shadow: 0 2px 8px #18181844;
      transition: background 0.2s, color 0.2s;
    }
    .back-btn:hover {
      background: #c10016;
      color: #fff;
    }
    /* Attractive input styling */
    input[type="text"] {
      background: #fff;
      color: #181818;
      border: 2px solid #181818;
      border-radius: 10px;
      padding: 12px 18px;
      font-size: 1.08rem;
      font-family: 'Roboto', Arial, sans-serif;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #18181822;
      margin-bottom: 0;
    }
    input[type="text"]:focus {
      border-color: #c10016;
      box-shadow: 0 0 0 2px #c1001633;
    }
    body {
      background: linear-gradient(120deg, #181818 0%, #ededed 60%, #c10016 100%);
      color: #181818;
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 1400px;
      margin: 40px auto;
      background: rgba(255,255,255,0.04);
      border: 1px solid #18181844;
      border-radius: 16px;
      box-shadow: 0 2px 16px #18181844;
      padding: 32px 24px;
    }
    h1 {
      text-align: center;
      font-size: 2.5rem;
      letter-spacing: 2px;
      margin-bottom: 24px;
      font-weight: 700;
      text-shadow: none;
      font-family: 'Roboto', Arial, sans-serif;
    }
    .choose-mission-black {
      color: #181818;
    }
    .choose-mission-red {
      color: #c10016;
    }
    .problem-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 40px 32px;
      margin: 32px auto 0 auto;
      width: 100%;
      max-width: 1200px;
    }
    @media (max-width: 900px) {
      .problem-list {
        grid-template-columns: 1fr;
        gap: 32px;
        max-width: 98vw;
      }
    }
    .problem-card {
      background: #181818;
      border: 1.5px solid #c10016;
      border-radius: 10px;
      box-shadow: 0 4px 24px #18181899;
      color: #ededed;
      transition: box-shadow 0.2s;
      position: relative;
      margin-bottom: 0;
      aspect-ratio: 1 / 1;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      padding: 32px 28px 28px 28px;
      box-sizing: border-box;
      overflow: hidden;
    }
    @media (max-width: 900px) {
      .problem-card {
        width: 100%;
        max-width: 100vw;
        aspect-ratio: 1 / 1;
        margin: 0 auto;
        height: 100%;
      }
    }
    .problem-card h2 {
      font-size: 1.4rem;
      margin-bottom: 12px;
      color: #c10016;
      text-shadow: none;
      font-family: 'Roboto', Arial, sans-serif;
      font-weight: bold;
    }
    .problem-card p {
      font-size: 1.08rem;
      margin-bottom: 10px;
      color: #ededed;
    }
    .problem-card .teams {
      font-size: 1rem;
      margin-bottom: 10px;
      color: #ededed;
    }
    .problem-card .cyber-btn {
      margin-top: 8px;
    }
    .cyber-btn {
      background: #c10016;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      padding: 10px 24px;
      margin-top: 12px;
      cursor: pointer;
      box-shadow: 0 2px 8px #18181844;
      transition: background 0.2s;
    }
    .cyber-btn:hover {
      background: #232323;
      color: #fff;
      border: 1px solid #c10016;
    }
    @media (max-width: 900px) {
      .problem-list {
        grid-template-columns: 1fr;
        max-width: 350px;
      }
    }
    .problem {
      background: #232323;
      border: 2px solid #c10016;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 16px #18181844;
      margin-bottom: 8px;
    }
    .problem.full {
      border-color: #c10016;
      color: #c10016;
      box-shadow: 0 0 16px #c10016;
    }
    .teams {
      margin-top: 10px;
      font-size: 0.95rem;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 32px;
      align-items: center;
      justify-content: center;
    }
    h1 {
      text-align: center;
      font-size: 2.5rem;
      letter-spacing: 2px;
      margin-bottom: 24px;
      color: #c10016;
      font-weight: 700;
      text-shadow: none;
      font-family: 'Roboto', Arial, sans-serif;
      outline: none;
    }
    .error {
      color: #c10016;
      text-shadow: none;
    }
    .cyber-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(24,24,24,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .cyber-modal.active {
      visibility: visible;
      opacity: 1;
    }
    .cyber-modal-content {
      background: #fff;
      border: 2px solid #c10016;
      border-radius: 18px;
      box-shadow: 0 8px 40px #18181888;
      padding: 36px 44px 28px 44px;
      color: #181818;
      text-align: left;
      min-width: 340px;
      max-width: 95vw;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-family: 'Roboto', Arial, sans-serif;
    }
    .cyber-modal-content h3 {
      margin: 0 0 18px 0;
      font-size: 1.4rem;
      color: #c10016;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .cyber-modal-content .modal-row {
      margin-bottom: 10px;
      font-size: 1.08rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .cyber-modal-content .modal-label {
      font-weight: 700;
      color: #181818;
      min-width: 120px;
    }
    .cyber-modal-content .modal-value {
      color: #c10016;
      font-weight: 500;
    }
    .cyber-modal-content .modal-problem-title {
      font-weight: 700;
      color: #c10016;
      font-size: 1.1rem;
      margin-bottom: 2px;
    }
    .cyber-modal-content .modal-problem-desc {
      color: #181818;
      font-size: 1rem;
      margin-bottom: 10px;
    }
    .cyber-modal-btns {
      margin-top: 18px;
      display: flex;
      gap: 18px;
      justify-content: flex-end;
      width: 100%;
    }
    .cyber-modal-btn {
      background: #c10016;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.08rem;
      padding: 8px 28px;
      cursor: pointer;
      box-shadow: 0 0 8px #18181844;
      transition: background 0.2s;
    }
    .cyber-modal-btn:hover {
      background: #181818;
      color: #fff;
      border: 2px solid #c10016;
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="window.location.href='home.html'">&#8592; Back</button>
  <div class="container">
    <div style="text-align:right; font-size:0.95rem; opacity:0.8; margin-bottom:8px;" id="clientIp">IP: detecting...</div>
    <h1 style="letter-spacing:2px; font-size:3.5rem; background: linear-gradient(90deg, #c10016 0%, #181818 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;">
      Choose the Mission
    </h1>
    <div id="message" class="message"></div>
    <form id="registerForm">
      <input type="text" id="teamNumber" placeholder="Team Number" required />
      <input type="text" id="teamName" placeholder="Team Name" required />
      <input type="text" id="teamLeader" placeholder="Team Leader" required />
      <input type="hidden" id="selectedProblemId" />
    </form>
    <div class="problem-list" id="problemList"></div>
  </div>

  <!-- Modal moved outside container for proper overlay -->
  <div class="cyber-modal" id="cyberModal">
    <div class="cyber-modal-content">
      <div id="cyberModalMsg"></div>
      <div class="cyber-modal-btns">
        <button class="cyber-modal-btn" id="cyberModalCancel">Cancel</button>
        <button class="cyber-modal-btn" id="cyberModalOk">OK</button>
      </div>
    </div>
  </div>

  <script>
    (async function showIp(){
      try {
        const res = await fetch('/api/ip');
        const data = await res.json();
        document.getElementById('clientIp').textContent = 'IP: ' + (data.ip || 'unknown');
      } catch (e) {
        const el = document.getElementById('clientIp');
        if (el) el.textContent = 'IP: unavailable';
      }
    })();
    async function fetchProblems() {
      const res = await fetch('/api/problem-statements');
      return await res.json();
    }
    function showCyberModal(details, onOk, onCancel) {
      const modal = document.getElementById('cyberModal');
      const msgDiv = document.getElementById('cyberModalMsg');
      msgDiv.innerHTML = details;
      modal.classList.add('active');
      function cleanup() {
        modal.classList.remove('active');
        document.getElementById('cyberModalOk').onclick = null;
        document.getElementById('cyberModalCancel').onclick = null;
      }
      document.getElementById('cyberModalOk').onclick = () => {
        cleanup();
        if (onOk) onOk();
      };
      document.getElementById('cyberModalCancel').onclick = () => {
        cleanup();
        if (onCancel) onCancel();
      };
    }

    function renderProblems(problems) {
      const list = document.getElementById('problemList');
      list.innerHTML = '';
      problems.forEach(ps => {
        const card = document.createElement('div');
        card.className = 'problem-card' + (ps.isAvailable ? '' : ' full');
        card.innerHTML = `
          <h2>${ps.title}</h2>
          <p>${ps.description}</p>
          <div class="teams">${ps.selectedCount}/${ps.maxSelections} teams</div>
          <button class="cyber-btn" ${ps.isAvailable ? '' : 'disabled'} data-id="${ps.id}">Select</button>
        `;
        list.appendChild(card);
      });
      // Add select button listeners
      list.querySelectorAll('.cyber-btn[data-id]').forEach(btn => {
        btn.onclick = function() {
          const psId = btn.getAttribute('data-id');
          const psTitle = btn.parentElement.querySelector('h2').textContent;
          const psDesc = btn.parentElement.querySelector('p').textContent;
          // Get team details from form
          const teamNumber = document.getElementById('teamNumber').value.trim();
          const teamName = document.getElementById('teamName').value.trim();
          const teamLeader = document.getElementById('teamLeader').value.trim();
          let details = `<h3>Confirm Registration</h3>`;
          details += `<div class='modal-row'><span class='modal-label'>Team Number:</span> <span class='modal-value'>${teamNumber || 'Not entered'}</span></div>`;
          details += `<div class='modal-row'><span class='modal-label'>Team Name:</span> <span class='modal-value'>${teamName || 'Not entered'}</span></div>`;
          details += `<div class='modal-row'><span class='modal-label'>Team Leader:</span> <span class='modal-value'>${teamLeader || 'Not entered'}</span></div>`;
          details += `<hr style='margin:12px 0 10px 0; border: none; border-top: 1.5px solid #c10016; width: 100%;'>`;
          details += `<div class='modal-problem-title'>Problem Statement: ${psTitle}</div>`;
          details += `<div class='modal-problem-desc'>${psDesc}</div>`;
          showCyberModal(details, () => {
            document.getElementById('selectedProblemId').value = psId;
            // Only submit if all fields are filled
            if (teamNumber && teamName && teamLeader && psId) {
              document.getElementById('registerForm').requestSubmit();
            } else {
              document.getElementById('registerForm').scrollIntoView({ behavior: 'smooth' });
            }
          });
        };
      });
    }
    // Removed dropdown rendering
    function showMessage(msg, error) {
      const el = document.getElementById('message');
      el.textContent = msg;
      el.className = error ? 'message error' : 'message';
      setTimeout(() => { el.textContent = ''; }, 3000);
    }
    document.getElementById('registerForm').onsubmit = async e => {
      e.preventDefault();
      const teamNumber = document.getElementById('teamNumber').value.trim();
      const teamName = document.getElementById('teamName').value.trim();
      const teamLeader = document.getElementById('teamLeader').value.trim();
      const problemStatementId = document.getElementById('selectedProblemId').value;
      if (!teamNumber || !teamName || !teamLeader || !problemStatementId) {
        showMessage('Please fill all fields and select a problem statement.', true);
        return;
      }
      // No browser confirm, registration is confirmed via modal
      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ teamNumber, teamName, teamLeader, problemStatementId })
      });
      const data = await res.json();
      if (res.ok) {
        showMessage('Registration successful!', false);
        load();
        document.getElementById('registerForm').reset();
        document.getElementById('selectedProblemId').value = '';
      } else {
        showMessage(data.error || 'Registration failed.', true);
      }
    };
    async function load() {
      const problems = await fetchProblems();
      renderProblems(problems);
    }
    load();
  </script>
<script>
// Mock API for static hosting
const mockProblems = [
  {
    "id": "ps001",
    "title": "Secure Authentication System",
    "description": "Design and implement a multi-factor authentication system with biometric verification, OTP, and secure session management for a banking application.",
    "maxSelections": 3,
    "selectedCount": 0,
    "isAvailable": true,
    "category": "Cybersecurity",
    "difficulty": "Advanced",
    "technologies": ["Node.js", "React", "MongoDB", "JWT", "WebAuthn"]
  },
  {
    "id": "ps002", 
    "title": "AI-Powered Threat Detection",
    "description": "Develop an intelligent system that can detect and prevent cyber threats in real-time using machine learning algorithms.",
    "maxSelections": 2,
    "selectedCount": 0,
    "isAvailable": true,
    "category": "AI/ML",
    "difficulty": "Expert",
    "technologies": ["Python", "TensorFlow", "Docker", "Kubernetes"]
  }
];

// Mock API functions
window.mockAPI = {
  async getProblems() {
    return mockProblems;
  },
  
  async register(data) {
    console.log('Mock registration:', data);
    return { message: 'Registration successful! (Mock)' };
  },
  
  async getIP() {
    return { ip: '127.0.0.1' };
  }
};

// Override fetch for API calls
const originalFetch = window.fetch;
window.fetch = async (url, options) => {
  if (url.includes('/api/problem-statements')) {
    return {
      ok: true,
      json: () => Promise.resolve(mockProblems)
    };
  }
  
  if (url.includes('/api/register')) {
    const data = JSON.parse(options.body);
    console.log('Mock registration:', data);
    return {
      ok: true,
      json: () => Promise.resolve({ message: 'Registration successful! (Mock)' })
    };
  }
  
  if (url.includes('/api/ip')) {
    return {
      ok: true,
      json: () => Promise.resolve({ ip: '127.0.0.1' })
    };
  }
  
  return originalFetch(url, options);
};
</script></body>
</html>
